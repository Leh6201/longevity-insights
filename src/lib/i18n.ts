import i18n from 'i18next';
import { initReactI18next } from 'react-i18next';
import { supabase } from '@/integrations/supabase/client';

const resources = {
  en: {
    translation: {
      // Auth
      welcome: "Welcome to LongLife AI",
      tagline: "Unlock your longevity potential with AI-powered health insights",
      signIn: "Sign In",
      signUp: "Sign Up",
      email: "Email",
      password: "Password",
      name: "Name",
      forgotPassword: "Forgot Password?",
      continueWithGoogle: "Continue with Google",
      continueWithApple: "Continue with Apple",
      continueWithFacebook: "Continue with Facebook",
      orContinueWith: "or continue with",
      or: "or",
      dontHaveAccount: "Don't have an account?",
      alreadyHaveAccount: "Already have an account?",
      createAccount: "Create Account",
      resetPassword: "Reset Password",
      sendResetLink: "Send Reset Link",
      backToLogin: "Back to Login",
      enterWithoutLogin: "Enter Without Login",
      
      // Guest Mode
      guestMode: "Guest Mode",
      guestBannerTitle: "Save your progress!",
      guestBannerDesc: "Create an account to save your data and access it anytime.",
      guestAccountMessage: "You're using guest mode. Create an account to save your progress.",
      
      // Onboarding
      onboardingTitle: "Let's personalize your experience",
      basicInfo: "Basic Information",
      lifestyle: "Lifestyle & Habits",
      healthGoals: "Health Goals",
      medicalHistory: "Medical History",
      age: "Age",
      biologicalSex: "Biological Sex",
      male: "Male",
      female: "Female",
      weight: "Weight (kg)",
      height: "Height (cm)",
      trainingFrequency: "Weekly Training Frequency",
      training0: "None",
      training1: "1-2 times",
      training2: "3-4 times",
      training3: "5+ times",
      sleepQuality: "Sleep Quality",
      sleepPoor: "Poor",
      sleepAverage: "Average",
      sleepGood: "Good",
      alcoholConsumption: "Alcohol Consumption",
      alcoholNone: "None",
      alcoholLow: "Low",
      alcoholModerate: "Moderate",
      alcoholHigh: "High",
      dailyWater: "Daily Water Intake (L)",
      mentalHealth: "Mental Health Level (1-10)",
      selectGoals: "Select Your Health Goals",
      loseWeight: "Lose Weight",
      improveEnergy: "Improve Energy",
      improveSleep: "Improve Sleep",
      reduceCholesterol: "Reduce Cholesterol",
      reduceBloodSugar: "Reduce Blood Sugar",
      increaseLongevity: "Increase Longevity",
      currentMedications: "Current Medications",
      medicationsPlaceholder: "List any medications you're currently taking...",
      medicalHistoryLabel: "Basic Medical History",
      medicalHistoryPlaceholder: "Any relevant medical conditions or history...",
      next: "Next",
      back: "Back",
      complete: "Complete Setup",
      profileSaved: "Your profile has been saved!",
      profileUpdated: "Your profile has been updated!",
      
      // Dashboard
      dashboard: "Dashboard",
      yourBiologicalAge: "Your Biological Age",
      bodyFunctioning: "Your body is functioning as if you were",
      yearsOld: "years old",
      greatNews: "Great news! Your biological age is lower than your actual age.",
      roomForImprovement: "Your biological age is higher than your actual age. Let's work on improving it!",
      metabolicRisk: "Metabolic Risk",
      inflammationScore: "Inflammation Score",
      low: "Low",
      moderate: "Moderate",
      high: "High",
      personalizedRecommendations: "Personalized Recommendations",
      lipidProfile: "Lipid Profile",
      glucoseMarkers: "Glucose Markers",
      liverFunction: "Liver Function",
      otherMarkers: "Other Markers",
      uploadLabTest: "Upload Lab Test",
      noLabResults: "No lab results yet",
      uploadFirst: "Upload your first lab test to get personalized insights",
      uploadFirstDescription: "Upload your first lab test to discover your biological age and get personalized health recommendations!",
      yourGoals: "Your Goals",
      lastAnalysis: "Last analysis",
      processingTime: "Processing time",
      reanalyze: "Reanalyze",
      reanalyzing: "Reanalyzing...",
      pleaseWait: "Please wait while we process your results.",
      resultsUpdated: "Your results have been updated!",
      shareWithDoctor: "Share with Doctor",
      analysisHistory: "Analysis History",
      trackProgress: "Track your progress over time",
      viewAllAnalyses: "View all your past analyses",
      advancedAnalytics: "Advanced Analytics",
      premiumAnalyticsDesc: "Get deeper insights with advanced analytics",
      unlockAdvancedFeatures: "Unlock advanced features",
      greatJob: "Great Job!",
      bioAgeImproved: "Your biological age improved by {{years}} years!",
      noFileToReanalyze: "No file available to reanalyze",
      reportGenerated: "Health report downloaded successfully!",
      reportError: "Failed to generate report. Please try again.",
      
      // Lab Upload
      uploadLabTitle: "Upload Your Lab Test",
      uploadDescription: "Upload your lab test results (PDF, image, or photo) and our AI will extract your biomarkers automatically.",
      dragDrop: "Drag and drop your file here, or click to browse",
      supportedFormats: "Supported formats: PDF, PNG, JPG",
      analyzing: "Analyzing your lab results...",
      analysisComplete: "Analysis Complete",
      
      // Settings
      settings: "Settings",
      profile: "Profile",
      editProfile: "Edit Profile",
      account: "Account",
      manageAccount: "Manage your account settings",
      appPreferences: "App Preferences",
      language: "Language",
      theme: "Theme",
      lightMode: "Light Mode",
      darkMode: "Dark Mode",
      saveChanges: "Save Changes",
      settingsSaved: "Settings saved successfully!",
      logout: "Logout",
      deleteAccount: "Delete Account",
      changePassword: "Change Password",
      editHealthData: "Edit Health Data",
      premium: "Premium",
      currentStatus: "Current status",
      viewPremiumPlans: "View Premium Plans",
      supportLegal: "Support & Legal",
      sendFeedback: "Send Feedback",
      termsOfUse: "Terms of Use",
      privacyPolicy: "Privacy Policy",
      featureComingSoon: "This feature is coming soon!",
      guest: "Guest",
      free: "Free",
      
      // Edit Profile
      ageWarning: "Changing your age will affect biological age calculations",
      biomarkersNotEditable: "Lab biomarkers can only be updated by uploading a new exam",
      
      // Premium
      premiumPlans: "Premium Plans",
      unlockFullPotential: "Unlock Your Full Potential",
      premiumDescription: "Get unlimited access to all features and take your health journey to the next level.",
      monthlyPlan: "Monthly",
      monthlyPlanDesc: "Billed monthly, cancel anytime",
      installmentPlan: "Installment",
      installmentPlanDesc: "Pay in 7 installments",
      month: "month",
      popular: "Most Popular",
      subscribe: "Subscribe",
      premiumBenefit1: "Unlimited lab test uploads",
      premiumBenefit2: "Advanced AI analysis",
      premiumBenefit3: "Full analysis history",
      premiumBenefit4: "Trend tracking & insights",
      premiumDisclaimer: "Subscription auto-renews. Cancel anytime in settings.",
      premiumFeature: "Premium Feature",
      unlockNow: "Unlock Now",
      
      // Tutorial
      skip: "Skip",
      getStarted: "Get Started",
      tutorialStep1Title: "Upload Your Lab Test",
      tutorialStep1Desc: "Upload your blood test results as PDF or image and let our AI extract your biomarkers.",
      tutorialStep2Title: "Discover Your Biological Age",
      tutorialStep2Desc: "See how your body is really aging based on your biomarkers and lifestyle data.",
      tutorialStep3Title: "Get Personalized Recommendations",
      tutorialStep3Desc: "Receive actionable health tips tailored to your unique profile.",
      
      // Biomarkers
      totalCholesterol: "Total Cholesterol",
      hdl: "HDL",
      ldl: "LDL",
      triglycerides: "Triglycerides",
      glucose: "Glucose",
      hemoglobin: "Hemoglobin",
      creatinine: "Creatinine",
      ast: "AST",
      alt: "ALT",
      ggt: "GGT",
      vitaminD: "Vitamin D",
      tsh: "TSH",
      crp: "CRP",
      notAvailable: "Not Available",
      
      // Biomarker Tooltips
      totalCholesterolTooltip: "Total cholesterol measures all cholesterol in your blood. High levels may increase risk of heart disease.",
      hdlTooltip: "HDL is 'good' cholesterol that helps remove other forms of cholesterol from your bloodstream.",
      ldlTooltip: "LDL is 'bad' cholesterol that can build up in arteries and increase heart disease risk.",
      triglycericesTooltip: "Triglycerides are fats in your blood. High levels may increase risk of heart disease.",
      glucoseTooltip: "Blood glucose measures sugar levels. High levels may indicate diabetes risk.",
      hemoglobinTooltip: "Hemoglobin carries oxygen in your blood. Low levels may indicate anemia.",
      creatinineTooltip: "Creatinine is a waste product filtered by kidneys. High levels may indicate kidney issues.",
      astTooltip: "AST is an enzyme found in the liver. Elevated levels may indicate liver damage.",
      altTooltip: "ALT is a liver enzyme. High levels often indicate liver inflammation or damage.",
      ggtTooltip: "GGT is a liver enzyme that can indicate liver or bile duct problems when elevated.",
      vitaminDTooltip: "Vitamin D is essential for bone health and immune function. Low levels are common.",
      tshTooltip: "TSH controls thyroid hormone production. Abnormal levels may indicate thyroid issues.",
      crpTooltip: "CRP indicates inflammation in the body. High levels may signal infection or chronic conditions.",
      
      // Disclaimer
      disclaimer: "This application does not provide medical diagnosis. Always consult a healthcare professional.",
      
      // General
      loading: "Loading...",
      error: "An error occurred",
      success: "Success",
      cancel: "Cancel",
      save: "Save",
      delete: "Delete",
      edit: "Edit",
      uploadForRecommendations: "Upload your lab tests to receive personalized recommendations",
      
      // New Dashboard
      bioAge: "Bio Age",
      risk: "Risk",
      tips: "Tips",
      healthProjections: "Health Projections",
      projectionNext10Years: "Projection next 10 years",
      cardiovascularHealth: "Cardiovascular Health",
      inflammatoryMarkers: "Inflammatory Markers",
      fastingGlucose: "Fasting Glucose",
      trend: "Trend",
      biomarkers: "Biomarkers",
      normal: "Normal",
      actions: "Actions",
      updatedAt: "Updated at",
      updatedNow: "Updated now",
      glucoseMetabolism: "Glucose Metabolism",
      
      // Health Goals (snake_case keys from database)
      lose_weight: "Lose Weight",
      improve_energy: "Improve Energy",
      improve_sleep: "Improve Sleep",
      reduce_cholesterol: "Reduce Cholesterol",
      reduce_blood_sugar: "Reduce Blood Sugar",
      increase_longevity: "Increase Longevity",
    },
  },
  pt: {
    translation: {
      // Auth
      welcome: "Bem-vindo ao LongLife AI",
      tagline: "Desbloqueie seu potencial de longevidade com insights de saúde baseados em IA",
      signIn: "Entrar",
      signUp: "Cadastrar",
      email: "E-mail",
      password: "Senha",
      name: "Nome",
      forgotPassword: "Esqueceu a senha?",
      continueWithGoogle: "Continuar com Google",
      continueWithApple: "Continuar com Apple",
      continueWithFacebook: "Continuar com Facebook",
      orContinueWith: "ou continue com",
      or: "ou",
      dontHaveAccount: "Não tem uma conta?",
      alreadyHaveAccount: "Já tem uma conta?",
      createAccount: "Criar Conta",
      resetPassword: "Redefinir Senha",
      sendResetLink: "Enviar Link",
      backToLogin: "Voltar ao Login",
      enterWithoutLogin: "Entrar sem Login",
      
      // Guest Mode
      guestMode: "Modo Visitante",
      guestBannerTitle: "Salve seu progresso!",
      guestBannerDesc: "Crie uma conta para salvar seus dados e acessá-los a qualquer momento.",
      guestAccountMessage: "Você está usando o modo visitante. Crie uma conta para salvar seu progresso.",
      
      // Onboarding
      onboardingTitle: "Vamos personalizar sua experiência",
      basicInfo: "Informações Básicas",
      lifestyle: "Estilo de Vida e Hábitos",
      healthGoals: "Objetivos de Saúde",
      medicalHistory: "Histórico Médico",
      age: "Idade",
      biologicalSex: "Sexo Biológico",
      male: "Masculino",
      female: "Feminino",
      weight: "Peso (kg)",
      height: "Altura (cm)",
      trainingFrequency: "Frequência de Treino Semanal",
      training0: "Nenhum",
      training1: "1-2 vezes",
      training2: "3-4 vezes",
      training3: "5+ vezes",
      sleepQuality: "Qualidade do Sono",
      sleepPoor: "Ruim",
      sleepAverage: "Média",
      sleepGood: "Boa",
      alcoholConsumption: "Consumo de Álcool",
      alcoholNone: "Nenhum",
      alcoholLow: "Baixo",
      alcoholModerate: "Moderado",
      alcoholHigh: "Alto",
      dailyWater: "Consumo Diário de Água (L)",
      mentalHealth: "Nível de Saúde Mental (1-10)",
      selectGoals: "Selecione Seus Objetivos de Saúde",
      loseWeight: "Perder Peso",
      improveEnergy: "Melhorar Energia",
      improveSleep: "Melhorar Sono",
      reduceCholesterol: "Reduzir Colesterol",
      reduceBloodSugar: "Reduzir Açúcar no Sangue",
      increaseLongevity: "Aumentar Longevidade",
      currentMedications: "Medicamentos Atuais",
      medicationsPlaceholder: "Liste os medicamentos que você está tomando...",
      medicalHistoryLabel: "Histórico Médico Básico",
      medicalHistoryPlaceholder: "Condições médicas ou histórico relevante...",
      next: "Próximo",
      back: "Voltar",
      complete: "Concluir",
      profileSaved: "Seu perfil foi salvo!",
      profileUpdated: "Seu perfil foi atualizado!",
      
      // Dashboard
      dashboard: "Painel",
      yourBiologicalAge: "Sua Idade Biológica",
      bodyFunctioning: "Seu corpo está funcionando como se você tivesse",
      yearsOld: "anos",
      greatNews: "Ótimas notícias! Sua idade biológica é menor que sua idade real.",
      roomForImprovement: "Sua idade biológica é maior que sua idade real. Vamos trabalhar para melhorar!",
      metabolicRisk: "Risco Metabólico",
      inflammationScore: "Índice de Inflamação",
      low: "Baixo",
      moderate: "Moderado",
      high: "Alto",
      personalizedRecommendations: "Recomendações Personalizadas",
      lipidProfile: "Perfil Lipídico",
      glucoseMarkers: "Marcadores de Glicose",
      liverFunction: "Função Hepática",
      otherMarkers: "Outros Marcadores",
      uploadLabTest: "Enviar Exame",
      noLabResults: "Nenhum resultado de exame",
      uploadFirst: "Envie seu primeiro exame para obter insights personalizados",
      uploadFirstDescription: "Envie seu primeiro exame para descobrir sua idade biológica e receber recomendações personalizadas!",
      yourGoals: "Seus Objetivos",
      lastAnalysis: "Última análise",
      processingTime: "Tempo de processamento",
      reanalyze: "Reanalisar",
      reanalyzing: "Reanalisando...",
      pleaseWait: "Por favor aguarde enquanto processamos seus resultados.",
      resultsUpdated: "Seus resultados foram atualizados!",
      shareWithDoctor: "Compartilhar com Médico",
      analysisHistory: "Histórico de Análises",
      trackProgress: "Acompanhe seu progresso ao longo do tempo",
      viewAllAnalyses: "Veja todas as suas análises anteriores",
      advancedAnalytics: "Análises Avançadas",
      premiumAnalyticsDesc: "Obtenha insights mais profundos com análises avançadas",
      unlockAdvancedFeatures: "Desbloqueie recursos avançados",
      greatJob: "Parabéns!",
      bioAgeImproved: "Sua idade biológica melhorou em {{years}} anos!",
      noFileToReanalyze: "Nenhum arquivo disponível para reanalisar",
      reportGenerated: "Relatório de saúde baixado com sucesso!",
      reportError: "Falha ao gerar relatório. Tente novamente.",
      
      // Lab Upload
      uploadLabTitle: "Envie Seu Exame",
      uploadDescription: "Envie seus resultados de exames (PDF, imagem ou foto) e nossa IA extrairá seus biomarcadores automaticamente.",
      dragDrop: "Arraste e solte seu arquivo aqui, ou clique para selecionar",
      supportedFormats: "Formatos suportados: PDF, PNG, JPG",
      analyzing: "Analisando seus resultados...",
      analysisComplete: "Análise Concluída",
      
      // Settings
      settings: "Configurações",
      profile: "Perfil",
      editProfile: "Editar Perfil",
      account: "Conta",
      manageAccount: "Gerencie as configurações da sua conta",
      appPreferences: "Preferências do App",
      language: "Idioma",
      theme: "Tema",
      lightMode: "Modo Claro",
      darkMode: "Modo Escuro",
      saveChanges: "Salvar Alterações",
      settingsSaved: "Configurações salvas com sucesso!",
      logout: "Sair",
      deleteAccount: "Excluir Conta",
      changePassword: "Alterar Senha",
      editHealthData: "Editar Dados de Saúde",
      premium: "Premium",
      currentStatus: "Status atual",
      viewPremiumPlans: "Ver Planos Premium",
      supportLegal: "Suporte e Legal",
      sendFeedback: "Enviar Feedback",
      termsOfUse: "Termos de Uso",
      privacyPolicy: "Política de Privacidade",
      featureComingSoon: "Este recurso está chegando em breve!",
      guest: "Visitante",
      free: "Gratuito",
      
      // Edit Profile
      ageWarning: "Alterar sua idade afetará os cálculos de idade biológica",
      biomarkersNotEditable: "Biomarcadores só podem ser atualizados enviando um novo exame",
      
      // Premium
      premiumPlans: "Planos Premium",
      unlockFullPotential: "Desbloqueie Todo Seu Potencial",
      premiumDescription: "Tenha acesso ilimitado a todos os recursos e leve sua jornada de saúde para o próximo nível.",
      monthlyPlan: "Mensal",
      monthlyPlanDesc: "Cobrado mensalmente, cancele quando quiser",
      installmentPlan: "Parcelado",
      installmentPlanDesc: "Pague em 7 parcelas",
      month: "mês",
      popular: "Mais Popular",
      subscribe: "Assinar",
      premiumBenefit1: "Uploads ilimitados de exames",
      premiumBenefit2: "Análise avançada de IA",
      premiumBenefit3: "Histórico completo de análises",
      premiumBenefit4: "Acompanhamento de tendências",
      premiumDisclaimer: "Assinatura renova automaticamente. Cancele a qualquer momento nas configurações.",
      premiumFeature: "Recurso Premium",
      unlockNow: "Desbloquear Agora",
      
      // Tutorial
      skip: "Pular",
      getStarted: "Começar",
      tutorialStep1Title: "Envie Seu Exame",
      tutorialStep1Desc: "Envie seus resultados de exame de sangue como PDF ou imagem e deixe nossa IA extrair seus biomarcadores.",
      tutorialStep2Title: "Descubra Sua Idade Biológica",
      tutorialStep2Desc: "Veja como seu corpo está realmente envelhecendo com base nos seus biomarcadores e estilo de vida.",
      tutorialStep3Title: "Receba Recomendações Personalizadas",
      tutorialStep3Desc: "Receba dicas de saúde acionáveis adaptadas ao seu perfil único.",
      
      // Biomarkers
      totalCholesterol: "Colesterol Total",
      hdl: "HDL",
      ldl: "LDL",
      triglycerides: "Triglicerídeos",
      glucose: "Glicose",
      hemoglobin: "Hemoglobina",
      creatinine: "Creatinina",
      ast: "AST",
      alt: "ALT",
      ggt: "GGT",
      vitaminD: "Vitamina D",
      tsh: "TSH",
      crp: "PCR",
      notAvailable: "Não Disponível",
      
      // Biomarker Tooltips
      totalCholesterolTooltip: "O colesterol total mede todo o colesterol no sangue. Níveis altos podem aumentar o risco de doenças cardíacas.",
      hdlTooltip: "HDL é o colesterol 'bom' que ajuda a remover outras formas de colesterol da corrente sanguínea.",
      ldlTooltip: "LDL é o colesterol 'ruim' que pode se acumular nas artérias e aumentar o risco de doenças cardíacas.",
      triglycericesTooltip: "Triglicerídeos são gorduras no sangue. Níveis altos podem aumentar o risco de doenças cardíacas.",
      glucoseTooltip: "A glicose no sangue mede os níveis de açúcar. Níveis altos podem indicar risco de diabetes.",
      hemoglobinTooltip: "A hemoglobina transporta oxigênio no sangue. Níveis baixos podem indicar anemia.",
      creatinineTooltip: "A creatinina é um produto residual filtrado pelos rins. Níveis altos podem indicar problemas renais.",
      astTooltip: "AST é uma enzima encontrada no fígado. Níveis elevados podem indicar dano hepático.",
      altTooltip: "ALT é uma enzima hepática. Níveis altos frequentemente indicam inflamação ou dano no fígado.",
      ggtTooltip: "GGT é uma enzima hepática que pode indicar problemas no fígado ou nas vias biliares quando elevada.",
      vitaminDTooltip: "A vitamina D é essencial para a saúde óssea e função imunológica. Níveis baixos são comuns.",
      tshTooltip: "O TSH controla a produção de hormônios da tireoide. Níveis anormais podem indicar problemas na tireoide.",
      crpTooltip: "A PCR indica inflamação no corpo. Níveis altos podem sinalizar infecção ou condições crônicas.",
      
      // Disclaimer
      disclaimer: "Este aplicativo não fornece diagnóstico médico. Sempre consulte um profissional de saúde.",
      
      // General
      loading: "Carregando...",
      error: "Ocorreu um erro",
      success: "Sucesso",
      cancel: "Cancelar",
      save: "Salvar",
      delete: "Excluir",
      edit: "Editar",
      uploadForRecommendations: "Envie seus exames para receber recomendações personalizadas",
      
      // New Dashboard
      bioAge: "Idade Bio",
      risk: "Risco",
      tips: "Dicas",
      healthProjections: "Projeções de Saúde",
      projectionNext10Years: "Projeção próximos 10 anos",
      cardiovascularHealth: "Saúde Cardiovascular",
      inflammatoryMarkers: "Marcadores Inflamatórios",
      fastingGlucose: "Glicose em Jejum",
      trend: "Tendência",
      biomarkers: "Biomarcadores",
      normal: "Normal",
      actions: "Ações",
      updatedAt: "Atualizado em",
      updatedNow: "Atualizado agora",
      glucoseMetabolism: "Metabolismo da Glicose",
      
      // Health Goals (snake_case keys from database)
      lose_weight: "Perder Peso",
      improve_energy: "Melhorar Energia",
      improve_sleep: "Melhorar Sono",
      reduce_cholesterol: "Reduzir Colesterol",
      reduce_blood_sugar: "Reduzir Açúcar no Sangue",
      increase_longevity: "Aumentar Longevidade",
    },
  },
};

// Function to get initial language
const getInitialLanguage = (): string => {
  // Check sessionStorage for guest
  const sessionLang = sessionStorage.getItem('longlife-language-guest');
  if (sessionLang) return sessionLang;
  
  // Check localStorage
  const storedLang = localStorage.getItem('longlife-language');
  if (storedLang) return storedLang;
  
  // Default to Portuguese (Brazil)
  return 'pt';
};

i18n.use(initReactI18next).init({
  resources,
  lng: getInitialLanguage(),
  fallbackLng: 'pt',
  interpolation: {
    escapeValue: false,
  },
});

// Helper function to change language and persist it
export const changeLanguage = async (lang: string, isGuest: boolean = false) => {
  i18n.changeLanguage(lang);
  localStorage.setItem('longlife-language', lang);
  
  if (isGuest) {
    sessionStorage.setItem('longlife-language-guest', lang);
  } else {
    // Try to save to profile if logged in
    const { data: { user } } = await supabase.auth.getUser();
    if (user) {
      await supabase
        .from('profiles')
        .update({ language: lang, updated_at: new Date().toISOString() })
        .eq('user_id', user.id);
    }
  }
};

export default i18n;
